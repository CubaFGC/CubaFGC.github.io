<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ranking Cuba FGC</title>
  <link href="/css/style.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
  <div id="bg-wallpaper"></div>
  <main>
    <div class="header-center">
   </div>
    <!-- Menu trigger en el header -->
    <div class="menu-trigger">
      <button id="menu-trigger-btn" aria-label="Abrir menú">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="#ffd600">
          <rect y="4" width="24" height="3" rx="1.5"/>
          <rect y="10.5" width="24" height="3" rx="1.5"/>
          <rect y="17" width="24" height="3" rx="1.5"/>
        </svg>
      </button>
      <nav id="menu-dropdown" class="menu-dropdown">
        <a href="index.html">Eventos</a>
        <a href="ranking.html">Ranking</a>
        <!-- ...otros enlaces si los hay... -->
      </nav>
    </div>
    <div class="dropdowns-center">
    <select id="event-dropdown" aria-label="Selecciona un evento" style="padding:0.6rem 1rem;border-radius:8px;font-size:1.1rem;margin-bottom:1rem;">
      <option value="vol1">Ranking General 2025/2026</option>
      <option value="vol2">Proximamente 2026</option>
    </select>
    <select id="game-dropdown" aria-label="Selecciona un juego" style="padding:0.6rem 1rem;border-radius:8px;font-size:1.1rem;">
      <option value="tekken">Tekken 8</option>
      <option value="sf6">Street Fighter 6</option>
      <option value="smash">Smash</option>
      <option value="ggst">Guilty Gear Strive</option>
    </select>
    </div>
    <input
      type="text"
      id="search-input"
      placeholder="Buscar por nombre..."
      style="display:block;margin:0 auto 1.5rem auto;max-width:300px;padding:0.5rem 1rem;border-radius:6px;border:1.5px solid #ffd600;background:#181218;color:#fff0f3;font-size:1rem;box-shadow:0 0 8px #ff225522;"
    />
    <div id="table-loader" class="loader" style="display:none;">
      <div class="spinner"></div>
      <span>Cargando datos...</span>
    </div>
    <table>
      <thead>
        <tr>
          <th>Ranking</th>
          <th>Player</th>
          <th>Points</th>
        </tr>
      </thead>
      <tbody>
        <!-- Datos dinámicos -->
      </tbody>
    </table>
  </main>

  <footer>
    <p>Powered by CubaFGC</p>
    <div class="social-links">
      <a href="https://www.facebook.com/profile.php?id=61576723526078" target="_blank" aria-label="Facebook">
        <svg width="26" height="26" fill="#ffd600" viewBox="0 0 24 24"><path d="M22.675 0h-21.35C.595 0 0 .592 0 1.326v21.348C0 23.406.595 24 1.325 24h11.495v-9.294H9.692v-3.622h3.128V8.413c0-3.1 1.893-4.788 4.659-4.788 1.325 0 2.463.099 2.797.143v3.24l-1.918.001c-1.504 0-1.797.715-1.797 1.763v2.313h3.587l-.467 3.622h-3.12V24h6.116C23.406 24 24 23.406 24 22.674V1.326C24 .592 23.406 0 22.675 0"></path></svg>
      </a>
      <a href="https://x.com/fgc_cuba " target="_blank" aria-label="X">
        <svg width="26" height="26" fill="#ffd600" viewBox="0 0 24 24"><path d="M17.53 2.47a.75.75 0 0 1 1.06 1.06L13.06 9l5.53 5.47a.75.75 0 1 1-1.06 1.06L12 10.06l-5.47 5.53a.75.75 0 1 1-1.06-1.06L10.94 9 5.41 3.53a.75.75 0 1 1 1.06-1.06L12 7.94l5.53-5.47z"></path></svg>
      </a>
      <a href="https://www.instagram.com/p/DKE4jibuwaB/?utm_source=ig_web_copy_link&igsh=MzRlODBiNWFlZA==" target="_blank" aria-label="Instagram">
        <svg width="26" height="26" fill="#ffd600" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 1.366.062 2.633.334 3.608 1.308.974.974 1.246 2.242 1.308 3.608.058 1.266.07 1.646.07 4.85s-.012 3.584-.07 4.85c-.062 1.366-.334 2.633-1.308 3.608-.974.974-2.242 1.246-3.608 1.308-1.266.058-1.646.07-4.85.07s-3.584-.012-4.85-.07c-1.366-.062-2.633-.334-3.608-1.308-.974-.974-1.246-2.242-1.308-3.608C2.175 15.647 2.163 15.267 2.163 12s.012-3.584.07-4.85c.062-1.366.334-2.633 1.308-3.608.974-.974 2.242-1.246 3.608-1.308C8.416 2.175 8.796 2.163 12 2.163zm0-2.163C8.741 0 8.332.013 7.052.072 5.771.131 4.659.384 3.678 1.365c-.98.98-1.233 2.092-1.293 3.374C2.013 8.332 2 8.741 2 12c0 3.259.013 3.668.072 4.948.06 1.282.313 2.394 1.293 3.374.98.98 2.092 1.233 3.374 1.293C8.332 23.987 8.741 24 12 24s3.668-.013 4.948-.072c1.282-.06 2.394-.313 3.374-1.293.98-.98 1.233-2.092 1.293-3.374.059-1.28.072-1.689.072-4.948 0-3.259-.013-3.668-.072-4.948-.06-1.282-.313-2.394-1.293-3.374-.98-.98-2.092-1.233-3.374-1.293C15.668.013 15.259 0 12 0zm0 5.838a6.162 6.162 0 1 0 0 12.324 6.162 6.162 0 0 0 0-12.324zm0 10.162a3.999 3.999 0 1 1 0-7.998 3.999 3.999 0 0 1 0 7.998zm6.406-11.845a1.44 1.44 0 1 0 0 2.88 1.44 1.44 0 0 0 0-2.88z"></path></svg>
      </a>
      <a href="https://chat.whatsapp.com/KRTZFqImCwbDhdQJviNyb4" target="_blank" aria-label="WhatsApp">
        <svg width="26" height="26" fill="#ffd600" viewBox="0 0 24 24">
          <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.198.297-.767.967-.94 1.166-.173.198-.347.223-.644.075-.297-.149-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.151-.174.2-.298.3-.497.099-.198.05-.372-.025-.521-.075-.148-.669-1.612-.916-2.206-.242-.579-.487-.5-.669-.51-.173-.008-.372-.01-.571-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.099 3.2 5.077 4.363.709.306 1.262.489 1.694.626.712.227 1.36.195 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.288.173-1.413-.074-.124-.272-.198-.57-.347zm-5.421 7.617h-.001a9.87 9.87 0 0 1-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 0 1-1.51-5.26c.001-5.455 4.436-9.89 9.893-9.89 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 0 1 2.896 6.994c-.003 5.455-4.438 9.89-9.893 9.89zm8.413-18.304A11.815 11.815 0 0 0 12.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L0 24l6.304-1.681a11.86 11.86 0 0 0 5.741 1.463h.005c6.554 0 11.889-5.335 11.892-11.893a11.82 11.82 0 0 0-3.477-8.386z"/>
        </svg>
      </a>
    </div>
  </footer>

  <script>
const hojas = {
  tekken: { nombre: "Tekken", gid: "995349228" },
  sf6:    { nombre: "SF6",    gid: "1164729105" }, // Cambia el gid por el de tu hoja SF6
  smash:  { nombre: "Smash",  gid: "1529661662" }, // Cambia el gid por el de tu hoja Smash
  ggst:   { nombre: "GGST",   gid: "179455813" }  // Cambia el gid por el de tu hoja GGST
};

const eventos = {
  vol1: {
    nombre: "Mixup Cash Fest VoL.1",
    baseUrl: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR8n9pG8YwSjWh7h9ilIuL-B08z5v-kYzk7R5GF19kgLSsebebE0g5rpx3VJcotdNecvm22HaOGoZHN/pub?single=true&output=csv&gid="
  },
  vol2: {
    nombre: "Mixup Cash Fest VoL.2",
    baseUrl: "" // No hay datos aún
  }
};

const baseUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR8n9pG8YwSjWh7h9ilIuL-B08z5v-kYzk7R5GF19kgLSsebebE0g5rpx3VJcotdNecvm22HaOGoZHN/pub?single=true&output=csv&gid=";

let lastData = [];

function loadGame(gameKey) {
  const eventKey = document.getElementById("event-dropdown").value;
  const evento = eventos[eventKey];
  const hoja = hojas[gameKey];
  document.getElementById("search-input").value = "";

  // Cambia el fondo según el juego
  const bg = document.getElementById("bg-wallpaper");
  bg.className = "";
  if (gameKey === 'tekken') bg.classList.add("bg-tekken");
  if (gameKey === 'sf6') bg.classList.add("bg-sf6");
  if (gameKey === 'smash') bg.classList.add("bg-smash");
  if (gameKey === 'ggst') bg.classList.add("bg-ggst");

  // Mostrar loader y ocultar tabla
  document.getElementById("table-loader").style.display = "flex";
  document.querySelector("table").style.visibility = "hidden";

  // Si el evento no tiene baseUrl, muestra mensaje y no carga datos
  if (!evento.baseUrl) {
    setTimeout(() => {
      document.getElementById("table-loader").style.display = "none";
      document.querySelector("table").style.visibility = "visible";
      showInfo([]); // Limpia la tabla
    }, 1000);
    return;
  }

  const url = evento.baseUrl + hoja.gid;
  const startTime = Date.now();

  Papa.parse(url, {
    download: true,
    header: true,
    complete: function(results) {
      lastData = results.data;
      const elapsed = Date.now() - startTime;
      const minTime = 1400; // 1.4 segundos
      const wait = elapsed < minTime ? minTime - elapsed : 0;
      setTimeout(() => {
        showInfo(lastData);
        document.getElementById("table-loader").style.display = "none";
        document.querySelector("table").style.visibility = "visible";
      }, wait);
    }
  });
}

function showInfo(data) {
  const tbody = document.querySelector("tbody");
  tbody.innerHTML = "";
  if (!data.length) {
    const tr = document.createElement("tr");
    const td = document.createElement("td");
    td.colSpan = 3;
    td.style.textAlign = "center";
    td.style.padding = "2rem 0";
    td.style.color = "#ffd600";
    td.style.fontWeight = "bold";
    td.textContent = "Próximamente disponible";
    tr.appendChild(td);
    tbody.appendChild(tr);
    return;
  }
  data.forEach(row => {
    if (!(row.Player || row.Ranking || row.Points)) return;
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${row.Ranking || ''}</td>
      <td>${row.Player || ''}</td>
      <td>${row.Points || ''}</td>
    `;
    tbody.appendChild(tr);
  });
}

document.getElementById("search-input").addEventListener("input", function() {
  const value = this.value.trim().toLowerCase();
  let filtered;
  if (!value) {
    filtered = lastData.filter(row => row.Player || row.Ranking || row.Points);
  } else {
    filtered = lastData.filter(row =>
      (row.Player || '').toLowerCase().includes(value)
    );
  }
  showInfo(filtered);
});

document.getElementById("game-dropdown").addEventListener("change", function() {
  const gameKey = this.value;
  loadGame(gameKey);
});

document.getElementById("event-dropdown").addEventListener("change", function() {
  const gameKey = document.getElementById("game-dropdown").value;
  loadGame(gameKey);
});

// Menu trigger
const menuTriggerBtn = document.getElementById('menu-trigger-btn');
const menuTrigger = document.querySelector('.menu-trigger');
menuTriggerBtn.addEventListener('click', function(e) {
  e.stopPropagation();
  menuTrigger.classList.toggle('open');
});
document.addEventListener('click', function() {
  menuTrigger.classList.remove('open');
});

window.loadGame = loadGame;
window.addEventListener('DOMContentLoaded', () => loadGame('tekken'));
  </script>
</body>
</html>
