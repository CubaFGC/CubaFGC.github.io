<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cuba FGC</title>
  <meta name="description" content="Comunidad Cuba FGC: torneos, rankings y eventos de juegos de pelea en Cuba.">
  <link rel="icon" href="img/favicon.ico" type="image/ico">
  <meta property="og:title" content="Cuba FGC" />
  <meta property="og:description" content="Comunidad Cuba FGC: torneos, rankings y eventos de juegos de pelea en Cuba." />
  <meta property="og:image" content="img/og-banner.jpg" />
  <meta property="og:type" content="website" />
  <link href="https://fonts.googleapis.com/css?family=Montserrat:700,400&display=swap" rel="stylesheet">
  <link href="/css/index.css" rel="stylesheet" /> 
  <link href="/css/main.css" rel="stylesheet" />
  <link href="/css/footer.css" rel="stylesheet" />
  <link href="/css/header.css" rel="stylesheet" />
  <style>
    .event-access-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 2rem;
      max-height: 650px;
      overflow-y: auto;
      padding: 2rem 2vw;
      justify-items: center;
      align-items: start;
      width: 100%;
    }
    @media (max-width: 700px) {
      .event-access-cards {
        grid-template-columns: 1fr;
        gap: 1.2rem;
        padding: 1rem 0.5rem;
      }
      .event-filter-row {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        margin-bottom: 1.2rem;
      }
      .event-filter-row label,
      .event-filter-row select {
        width: 100%;
        text-align: center;
        margin: 0.2rem 0;
      }
    }
    .event-access-card {
      margin: 0 auto;
      background: rgba(34,34,34,0.82);
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
      padding: 1.2rem 1rem 1rem 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 180px;
      transition: box-shadow 0.2s, background 0.2s;
      backdrop-filter: blur(2px);
    }
    .event-access-card:hover {
      box-shadow: 0 4px 16px rgba(0,0,0,0.18);
    }
    .event-access-title {
      font-size: 1.15rem;
      font-weight: 700;
      margin-bottom: 0.7rem;
      text-align: center;
      color: #fff;
    }
    .event-access-status {
      font-size: 0.98rem;
      margin-bottom: 0.7rem;
      padding: 0.2rem 0.7rem;
      border-radius: 8px;
      background: #333;
      color: #fff;
      display: inline-block;
    }
    .event-access-status.disponible {
      background: #1b7e2a;
      color: #fff;
    }
    .event-access-status.cerrado {
      background: #a12c2c;
      color: #fff;
    }
    .event-access-status.cargando {
      background: #444;
      color: #fff;
    }
    .event-access-btn {
      background: #1b7e2a;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 0.5rem 1.2rem;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 0.5rem;
      transition: background 0.2s;
    }
    .event-access-btn:hover {
      background: #145a1e;
    }
  </style>
</head>
<body>
  <div id="header-include"></div>
  <main>  
    <div class="header-center">
      <h1>Eventos destacados Cuba FGC</h1>
      <p class="slogan">¡Donde la comunidad cubana de fighting games compite y crece!</p>
    </div>
    <div class="event-filter-row" style="text-align:center;margin-bottom:1.2rem;">
      <label for="event-filter" style="font-weight:600;color:#222;font-size:1.08rem;margin-right:0.7rem;">Ver:</label>
      <select id="event-filter" class="event-filter-select">
        <option value="activos" selected>Activos</option>
        <option value="cerrados">Cerrados</option>
      </select>
    </div>
    <div class="event-access-cards">
      <!-- Tarjetas de eventos generadas dinámicamente -->
      <div id="mixup-card" class="event-access-card" style="display:none;">
        <div class="event-access-title">Mixup Clash Fest</div>
        <span id="mixup-status" class="event-access-status"></span>
        <button id="mixup-historial-btn" class="event-access-btn" style="display:none;background:#FFD600;color:#222;margin-bottom:0.5rem;">Ver historial</button>
      </div>
      <div id="mixup-card-vol2" class="event-access-card" style="display:none;">
        <div class="event-access-title">Mixup Clash Fest Vol.2</div>
        <span id="mixup-status-vol2" class="event-access-status"></span>
        <button class="event-access-btn" style="display:none;background:#FFD600;color:#222;margin-bottom:0.5rem;">Ver historial</button>
      </div>
    </div>
    <div style="text-align:center;margin:1.5rem 0;">
      <a href="https://discord.gg/fgC7GGv8DK" target="_blank" class="discord-btn">
        <svg width="22" height="22" fill="#fff" style="vertical-align:middle;margin-right:8px;" viewBox="0 0 24 24"><path d="M20.317 4.369A19.791 19.791 0 0 0 16.885 3.1a.074.074 0 0 0-.079.037c-.34.607-.719 1.395-.984 2.01a18.524 18.524 0 0 0-5.447 0 12.51 12.51 0 0 0-.995-2.01.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.369a.069.069 0 0 0-.032.027C.533 9.09-.32 13.579.099 18.021a.082.082 0 0 0 .031.056c2.052 1.507 4.041 2.422 5.992 3.029a.077.077 0 0 0 .084-.027c.461-.63.873-1.295 1.226-1.994a.076.076 0 0 0-.041-.104c-.652-.247-1.27-.549-1.872-.892a.077.077 0 0 1-.008-.127c.126-.094.252-.192.371-.291a.074.074 0 0 1 .077-.01c3.927 1.793 8.18 1.793 12.061 0a.073.073 0 0 1 .078.009c.12.099.245.198.372.292a.077.077 0 0 1-.006.127 12.298 12.298 0 0 1-1.873.891.076.076 0 0 0-.04.105c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028c1.961-.607 3.95-1.522 6.002-3.029a.077.077 0 0 0 .031-.055c.5-5.177-.838-9.637-3.548-13.625a.061.061 0 0 0-.031-.028zM8.02 15.331c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.418 2.157-2.418 1.21 0 2.175 1.094 2.157 2.418 0 1.334-.955 2.419-2.157 2.419zm7.974 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.418 2.157-2.418 1.21 0 2.175 1.094 2.157 2.418 0 1.334-.947 2.419-2.157 2.419z"/></svg>
        Únete a nuestro Discord
      </a>
    </div>
  </main>
  <footer id="footer-include"></footer>
  <script>
  fetch('/view/partials/footer.html')
    .then(res => res.text())
    .then(html => {
      document.getElementById('footer-include').innerHTML = html;
    });
</script>
  <script>
    // Menu trigger
    const menuTriggerBtn = document.getElementById('menu-trigger-btn');
    const menuTrigger = document.querySelector('.menu-trigger');
    if (menuTriggerBtn && menuTrigger) {
      menuTriggerBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        menuTrigger.classList.toggle('open');
      });
      document.addEventListener('click', function() {
        menuTrigger.classList.remove('open');
      });
    }
  </script>
  <script>
  fetch('/view/partials/header.html')
    .then(res => res.text())
    .then(html => {
      document.getElementById('header-include').innerHTML = html;
    })
    // Eliminado Supabase y auth.js
</script>
<script>
const STARTGG_TOKEN = "a7fafdd3139b23f9eef417bbe26fd91b";

// Cache para torneos
let torneosCache = null;
let torneosCacheTime = 0;
const CACHE_DURATION = 5 * 60 * 1000; // 5 minutos

// Mapa de historial por defecto (se puede agregar manualmente para casos especiales)
const HISTORIAL_MAP = {
  "mixup-clash-fest": "/view/mcf/Rankings/rankingGeneral.html",
  "mixup-clash-fest-vol-2": "/view/mcf/Rankings/rankingGeneral.html",
  "mixup-clash-fest-vol-3": "/view/mcf/Rankings/rankingGeneral.html",
  "mixup-clash-fest-vol-4": "/view/mcf/Rankings/rankingGeneral.html",
  "tekken-open-match": "/view/historial/tekken8_v2.html",
  "tekken-open-match-vol-2": "/view/historial/tekken8_v2.html",
  "sf6-open-match": "/view/historial/sf6_v1.html",
  "strive-open-match": "/view/historial/strive_v2.html",
  // Por defecto, todos los demás apuntan al ranking general
  "default": "/view/mcf/Rankings/rankingGeneral.html"
};

// Obtiene todos los torneos del usuario automáticamente
async function obtenerTorneosAutomatico() {
  const now = Date.now();
  if (torneosCache && (now - torneosCacheTime) < CACHE_DURATION) {
    return torneosCache;
  }

  try {
    console.log('[Index] Obteniendo torneos automáticamente...');
    const query = `
      query {
        currentUser {
          tournaments(query: {
            perPage: 50
            page: 1
          }) {
            nodes {
              name
              slug
              state
            }
          }
        }
      }
    `;
    
    const res = await fetch('https://api.start.gg/gql/alpha', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ' + STARTGG_TOKEN
      },
      body: JSON.stringify({ query })
    });
    
    const data = await res.json();
    const torneos = data.data?.currentUser?.tournaments?.nodes || [];
    
    console.log(`[Index] ${torneos.length} torneos encontrados:`);
    torneos.forEach(t => console.log(`  - ${t.name} (${t.slug}) - Estado: ${t.state}`));
    
    torneosCache = torneos;
    torneosCacheTime = now;
    
    return torneos;
  } catch (error) {
    console.error('[Index] Error al obtener torneos:', error);
    return [];
  }
}

function estadoTexto(state) {
  switch(state) {
    case 1: // Active
    case 5: // In Progress
      return {txt: "Abierto", cls: "disponible"};
    case 2: // Completed
    case 4: // Cancelled
    case 3: // Pending
      return {txt: "Cerrado", cls: "cerrado"};
    case -1:
      return {txt: "No encontrado", cls: "cerrado"};
    default:
      return {txt: "Desconocido", cls: "cargando"};
  }
}
function renderEventos(events) {
  const container = document.querySelector('.event-access-cards');
  container.innerHTML = "";
  const filter = (document.getElementById('event-filter')?.value || 'activos').toLowerCase();
  let filtered = [];
  if (filter === 'activos') {
    filtered = events.filter(ev => {
      const estado = estadoTexto(ev.state);
      return estado.cls === 'disponible';
    });
  } else if (filter === 'cerrados') {
    filtered = events.filter(ev => {
      const estado = estadoTexto(ev.state);
      return estado.cls === 'cerrado';
    });
  }
  if (!filtered.length) {
    container.innerHTML = '<div style="text-align:center;padding:2rem;"><span class="event-access-status cerrado">No hay eventos ' + filter + '</span></div>';
    return;
  }
  filtered.forEach(ev => {
    const estado = estadoTexto(ev.state);
    const historialUrl = HISTORIAL_MAP[ev.slug] || HISTORIAL_MAP["default"];
    const card = document.createElement('div');
    card.className = 'event-access-card';
    let btnInscripcion = '';
    let btnHistorial = '';
    
    if (estado.cls === 'disponible') {
      btnInscripcion = `<button class="event-access-btn" style="background:#2ecc40;margin-bottom:0.5rem;" onclick="window.open('https://www.start.gg/${ev.slug}','_blank')">Inscribirse</button>`;
      if (historialUrl) {
        btnHistorial = `<button class="event-access-btn" style="background:#FFD600;color:#222;margin-bottom:0.5rem;" onclick="window.location.href='${historialUrl}'">Ver historial</button>`;
      }
    } else if (estado.cls === 'cerrado') {
      if (historialUrl) {
        btnHistorial = `<button class="event-access-btn" style="background:#FFD600;color:#222;margin-bottom:0.5rem;" onclick="window.location.href='${historialUrl}'">Ver historial</button>`;
      } else {
        btnHistorial = `<button class="event-access-btn" style="background:#FFD600;color:#222;margin-bottom:0.5rem;" onclick="window.open('https://www.start.gg/${ev.slug}','_blank')">Ver en start.gg</button>`;
      }
    }
    card.innerHTML = `
      <div class="event-access-bg"></div>
      <div class="event-access-title">${ev.name}</div>
      <span class="event-access-status ${estado.cls}">${estado.txt}</span>
      ${btnInscripcion}
      ${btnHistorial}
    `;
    container.appendChild(card);
  });
}

async function obtenerEventosCubaFGC() {
  const container = document.querySelector('.event-access-cards');
  container.innerHTML = '<div style="text-align:center;padding:2rem;"><span class="event-access-status cargando">Cargando torneos...</span></div>';
  
  // Obtener todos los torneos automáticamente
  const torneos = await obtenerTorneosAutomatico();
  
  if (torneos.length === 0) {
    container.innerHTML = '<div style="text-align:center;padding:2rem;"><span class="event-access-status cerrado">No se encontraron torneos</span></div>';
    return;
  }
  
  window._eventosCubaFGC = torneos;
  const filter = document.getElementById('event-filter');
  if (filter) {
    filter.value = 'activos';
    filter.onchange = function() {
      renderEventos(window._eventosCubaFGC);
    };
  }
  renderEventos(window._eventosCubaFGC);
}
document.addEventListener('DOMContentLoaded', obtenerEventosCubaFGC);
</script>
<script>
  </script>
</body>
</html>